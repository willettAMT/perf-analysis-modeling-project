#!/bin/bash

# Analysis script to fill in the performance summary tables

echo "=== Performance Analysis ===="
echo ""
echo "1-GPU Configuration (L40S - orcaga02):"
echo "======================================="
echo ""
echo "| Configuration | Prompt (pp512) | Generation (tg128) | Speedup vs CPU (pp) | Speedup vs CPU (tg) |"
echo "|---------------|----------------|--------------------|--------------------|---------------------|"
echo "| CPU-Only      | 7.12 t/s       | 15.84 t/s         | 1.00x              | 1.00x               |"
echo "| GPU Partial   | 9.76 t/s       | 19.67 t/s         | 1.37x              | 1.24x               |"
echo "| GPU Full      | 7698.65 t/s    | 104.61 t/s        | 1081x              | 6.60x               |"
echo ""
echo ""
echo "4-GPU Configuration (L40S - orcaga01):"
echo "======================================="
echo ""
echo "| Configuration      | GPUs | Prompt (pp512) | Generation (tg128) | Speedup vs 1 GPU |"
echo "|--------------------|------|----------------|--------------------|--------------------|"
echo "| Single GPU         | 1    | 7907.81 t/s    | 104.18 t/s        | 1.00x (baseline)   |"
echo "| Dual GPU           | 2    | 7820.44 t/s    | 103.80 t/s        | 0.99x              |"
echo "| Quad GPU Balanced  | 4    | 7758.68 t/s    | 104.46 t/s        | 0.98x              |"
echo "| Quad GPU Custom    | 4    | 7684.82 t/s    | 104.48 t/s        | 0.97x              |"
echo ""
echo ""
echo "Key Insights:"
echo "============="
echo ""
echo "1. GPU Acceleration Impact:"
echo "   - Prompt processing sees MASSIVE improvement (1081x speedup)"
echo "   - Text generation sees moderate improvement (6.6x speedup)"
echo ""
echo "2. Multi-GPU Scaling:"
echo "   - NO benefit for inference workloads"
echo "   - Slight performance degradation (likely communication overhead)"
echo "   - Single GPU is optimal for this model size"
echo ""
echo "3. Hardware Comparison:"
echo "   - L40S significantly outperforms A30 (7908 vs 2423 t/s)"
echo "   - L40S has higher compute capability (8.9 vs 8.0)"
echo ""
echo "4. Optimal Configuration:"
echo "   - For maximum throughput: Single GPU, full offload"
echo "   - Multi-GPU adds NO value for 8B parameter models"
echo "   - Larger models (33B+) would benefit more from multi-GPU"
echo ""
echo "5. Partial GPU Offloading:"
echo "   - WORSE than both CPU-only and full GPU"
echo "   - CPUâ†”GPU transfer overhead kills performance"
echo "   - Use all-or-nothing approach"
